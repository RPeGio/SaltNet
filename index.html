<!doctype html>
<html lang="en" class="mdui-theme-auto">
    <head>
        <meta charset="UTF-8" />
        <link rel="icon" type="image/icon" href="/favicon.ico" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=contain"
        />
        <link rel="stylesheet" href="/MaterialIcons/regular.css" />
        <link rel="manifest" href="/manifest.json" />
        <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1f" />
        <meta name="theme-color" media="(prefers-color-scheme: light)" content="#fefbff" />
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="mobile-web-app-capable" content="yes" />
        <meta name="description" content="SaltNet: 舞萌DX查分器" />
        <meta name="keyword" content="舞萌DX, 水鱼, b50" />
        <meta name="author" content="realtvop" />
        <title>SaltNet</title>
        <script>
            window.spec = {
                currentVersionBuildTime: "%buildTime%",
            };
        </script>
    </head>
    <body>
        <div id="app"></div>
        <script type="module" src="/src/main.ts"></script>
        <script>
            if ([80, 443, 1443, "1443", "", "1145"].includes(location.port))
                navigator.serviceWorker
                    .register("/sw.js", { scope: "/" })
                    .then(err => console.log("SW_Reg_Failed: ", err));
        </script>
        <script>
            if ('navigation' in window) {
                let isExitToastVisible = false;
                let toastTimer;

                window.navigation.addEventListener('navigate', (event) => {
                    const isRoot = new URL(location.href).pathname === '/'; // 檢查當前是否在根目錄
                    if (event.navigationType === 'traverse' && isRoot && window.navigation.canGoBack === false) {
                        event.intercept({
                            handler: () => {
                                if (isExitToastVisible) {
                                    // 如果提示已經顯示，則這次什麼都不做，讓App關閉
                                    // (注意：攔截後App不會自動關閉，這是API的限制。使用者需要再次按返回)
                                    // 這裡的邏輯需要調整以符合預期
                                    // 最好的方法是根本不要第二次攔截
                                    window.close(); // 嘗試關閉，但不一定成功
                                    return;
                                }

                                isExitToastVisible = true;
                                snackbar({
                                    message: "再按一次返回鍵即可退出",
                                });

                                // 2秒後重置狀態
                                toastTimer = setTimeout(() => {
                                    isExitToastVisible = false;
                                }, 2000);
                            },
                        });
                    }
                });
            }
        </script>
    </body>
</html>
